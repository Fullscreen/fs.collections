(function(){angular.module("fs.collections",[])}).call(this);
(function(){var t,e=[].slice;t=angular.module("fs.collections"),t.factory("BaseCollection",["$http","BaseModel",function(t,r){var o,n,i;return o=function(){function e(t,e){this.opts=e,this.opts&&(this.opts.model&&(this.model=this.opts.model),this.opts.url&&(this.url=this.opts.url),this.opts.sort&&(this.sort=this.opts.sort),this.opts.comparator&&(this.comparator=this.opts.comparator),this.opts.parse&&"function"==typeof this.opts.parse&&(this.parse=this.opts.parse,delete this.opts.parse)),this.models=[],this.length=0,this.add(t,this.opts)}return e.prototype.model=r,e.prototype.currentlyFetching=!1,e.prototype.url=function(){},e.prototype.parse=function(t){return t.data},e.prototype.fetch=function(e){var r,o;return r={merge:!0,parse:!0,method:"GET",url:_(this).result("url")},e=_.extend(r,e),e.params&&(e.params=_.extend({},e.params)),e.data&&(e.data=_.extend({},e.data)),this.currentlyFetching=!0,o=t(e).then(function(t){return function(r){return e.reset&&t.reset(),t.add(r,e),t}}(this)),o["finally"](function(t){return function(){return t.currentlyFetching=!1}}(this)),o},e.prototype.eq=function(t){var e;return null!=(e=this.models)?e[t]:void 0},e.prototype.get=function(t){return _(this.models).findWhere({id:t})},e.prototype.remove=function(t){var e,r;return e=!_(t).isArray(),e&&(t=[t]),r=[],_(t).forEach(function(t){return function(e){var o;return o=t.indexOf(e),-1!==o?(r.push(e),t.models.splice(o,1),t.length--):void 0}}(this)),e?r[0]:r},e.prototype.add=function(t,e){var r,o,n;return e=_.extend({sort:!0},e),e.parse&&(t=this.parse(t)),t?(n=!_(t).isArray(),t=n?[t]:t.slice(),r=[],o="undefined"==typeof e.at?this.length:e.at,t.forEach(function(t){return function(n){var i;return n=t._prepareModel(n,e),i=t.get(n.id),null==i?(r.push(n),t.length++,t.models.splice(o,0,n),o++):e.merge?i.set(n.attributes,e):void 0}}(this)),e.sort&&this.sort(),n?r[0]:r):void 0},e.prototype.create=function(t,e){var r;return r=this.add(t,e),r?r.save():void 0},e.prototype.clone=function(){return new this.constructor(this.toJSON(),this.opts)},e.prototype.toJSON=function(){return _.map(this.models,function(t){return t.toJSON()})},e.prototype.reset=function(){return this.models=[],this.length=0,this},e.prototype.sort=function(){return this.comparator?this.models.sort(this.comparator):void 0},e.prototype._prepareModel=function(t,r){var o;return r=_.extend({collection:this},r),t instanceof this.model||t instanceof e?(o=t,o.collection=this):o=new this.model(t,r),o},e.prototype.pluck=function(t){return _.invoke(this.models,"get",t)},e.prototype.where=function(t,e){return t?this[e?"find":"filter"](function(e){var r,o;for(r in t)if(o=t[r],t[r]!==e.get(r))return!1;return!0}):e?void 0:[]},e.prototype.findWhere=function(t){return this.where(t,!0)},e}(),i=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"],_.each(i,function(t){return o.prototype[t]=function(){var r;return r=1<=arguments.length?e.call(arguments,0):[],r.unshift(this.models),_[t].apply(_,r)}}),n=["groupBy","countBy","sortBy"],_.each(n,function(t){return o.prototype[t]=function(e,r){var o;return o=_.isFunction(e)?e:function(t){return t.get(e)},_[t](this.models,o,r)}}),o}])}).call(this);
(function(){var t,e=[].slice;t=angular.module("fs.collections"),t.factory("BaseModel",["$http","$rootScope",function(t,n){var r,i;return r=function(){function r(t,e){null==t&&(t={}),null==e&&(e={}),e.parse&&(t=this.parse(t)),this._eventBus=n.$new(),this._eventBus.destuctors={},this._eventBus.$on("$destroy",function(t){return function(){return _(t._eventBus.destuctors).each(function(t){return t.forEach(function(t){return t.unwatch()})})}}(this)),e.collection&&(this.collection=e.collection),e.urlRoot&&(this.urlRoot=e.urlRoot),e.idAttribute&&(this.idAttribute=e.idAttribute),e.defaults&&(this.defaults=e.defaults),this.attributes={},t=_.extend({},t),t=_.defaults(t,_.result(this,"defaults")),this.set(t)}return r.prototype.parse=function(t){return t.status&&t.headers?t.data:t},r.prototype._hasIdAttribute=function(t){return _(Object.keys(t)).contains(this.idAttribute)},r.prototype.trigger=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this._eventBus.$broadcast.apply(this._eventBus,t)},r.prototype.on=function(t,n){var r,i;return this._eventBus.destuctors[t]||(this._eventBus.destuctors[t]=[]),r=this._eventBus.destuctors[t],i=function(){var t,r,i;return i=arguments[0],r=arguments[1],t=3<=arguments.length?e.call(arguments,2):[],n.apply(this,[r].concat(t))},r.push({unwatch:this._eventBus.$on(t,i),original:n})},r.prototype.off=function(t,e){var n,r;return n=this._eventBus.destuctors[t]||[],r=[],r=e?n.filter(function(t){return t.original===e}):n,r.forEach(function(t){return t.unwatch()})},r.prototype.once=function(t,n){var r;return r=function(i){return function(){var u;return u=1<=arguments.length?e.call(arguments,0):[],i.off(t,r),n.apply(i,u)}}(this),this.on(t,r)},r.prototype.has=function(t){return null!=this.attributes[t]},r.prototype.get=function(t){return this.attributes[t]},r.prototype.set=function(t,e){var n,r;return t?("object"==typeof t?n=t:(n={},n[t]=e),r={},this._hasIdAttribute(n)&&(this.id=n[this.idAttribute]),_(n).each(function(t){return function(e,n){return t.attributes[n]!==e&&(r[n]=e),t.attributes[n]=e}}(this)),this.trigger("change",this,r),_(r).each(function(t){return function(e,n){return t.trigger("change:"+n,t,e)}}(this)),this):this},r.prototype.urlRoot="",r.prototype.idAttribute="id",r.prototype.isNew=function(){return null!=this.id?!1:!0},r.prototype.url=function(){var t,e;return t=_.result(this,"urlRoot")||_.result(this.collection,"url"),this.isNew()?t:(e=encodeURIComponent(this.id),t+("/"===t.charAt(t.length-1)?e:"/"+e))},r.prototype.toJSON=function(){return _.clone(this.attributes)},r.prototype.fetch=function(e){var n;return null==e&&(e={}),n=_.extend({},e),_(n).defaults({method:"GET",url:_.result(this,"url")}),t(n).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},r.prototype.save=function(e){var n;return null==e&&(e={}),n=_.extend({},e),_(n).defaults({method:this.isNew()?"POST":"PUT",url:_.result(this,"url"),data:this.toJSON()}),t(n).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},r.prototype.destroy=function(e){var n;return null==e&&(e={}),this.collection&&this.collection.remove(this),n=function(t){return function(){return t.trigger("destroy",t,t.collection,e),t._eventBus.$destroy()}}(this),this.isNew()?n():(_(e).defaults({method:"DELETE",url:this.url("delete")}),t(e).then(_(this.parse).bind(this)).then(n))},r}(),i=["keys","values","pairs","invert","pick","omit"],_.each(i,function(t){return r.prototype[t]=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n.unshift(this.attributes),_[t].apply(_,n)}}),r}])}).call(this);