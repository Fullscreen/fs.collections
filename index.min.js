(function(){angular.module("fs.collections",[])}).call(this);
(function(){var t,e=[].slice;t=angular.module("fs.collections"),t.factory("BaseCollection",["$http","BaseModel",function(t,n){var r,o,i;return r=function(){function e(t,e){var n,r,o;this.opts=e,o=this.opts;for(n in o)r=o[n],this[n]=r;this.models=[],this.length=0,this.add(t)}return e.prototype.model=n,e.prototype.currentlyFetching=!1,e.prototype.url=function(){},e.prototype.parse=function(t){return t.data},e.prototype.fetch=function(e){var n,r;return n={method:"GET",url:_(this).result("url")},e=_.extend(n,e),e.params&&(e.params=_.extend({},e.params)),e.data&&(e.data=_.extend({},e.data)),this.currentlyFetching=!0,r=t(e).then(_.bind(this.parse,this)).then(function(t){return function(e){return t.add(e),t}}(this)),r["finally"](function(t){return function(){return t.currentlyFetching=!1}}(this)),r},e.prototype.eq=function(t){var e;return null!=(e=this.models)?e[t]:void 0},e.prototype.get=function(t){return _(this.models).findWhere({id:t})},e.prototype.remove=function(t){var e,n;return e=!_(t).isArray(),e&&(t=[t]),n=[],_(t).forEach(function(t){return function(e){var r;return r=t.indexOf(e),-1!==r?(n.push(e),t.models.splice(r,1),t.length--):void 0}}(this)),e?n[0]:n},e.prototype.add=function(t,e){var n,r,o;if(t)return e=_.extend({sort:!0},e),o=!_(t).isArray(),t=o?[t]:t.slice(),n=[],r="undefined"==typeof e.at?this.length:e.at,t.forEach(function(t){return function(e){return e=t._prepareModel(e),null==t.get(e.id)?(n.push(e),t.length++,t.models.splice(r,0,e),r++):void 0}}(this)),e.sort&&this.sort(),o?n[0]:n},e.prototype.create=function(t){var e;return e=this.add(t),e?e.save():void 0},e.prototype.clone=function(){return new this.constructor(this.toJSON(),this.opts)},e.prototype.toJSON=function(){return _.map(this.models,function(t){return t.toJSON()})},e.prototype.reset=function(){return this.models=[],this.length=0,this},e.prototype.sort=function(){return this.models.sort(this.comparator?this.comparator:function(t,e){return t.id-e.id})},e.prototype._prepareModel=function(t){var e;return t instanceof this.model?(e=t,e.collection=this):e=new this.model(t,{collection:this}),e},e.prototype.pluck=function(t){return _.invoke(this.models,"get",t)},e.prototype.where=function(t,e){return t?this[e?"find":"filter"](function(e){var n,r;for(n in t)if(r=t[n],t[n]!==e.get(n))return!1;return!0}):e?void 0:[]},e.prototype.findWhere=function(t){return this.where(t,!0)},e}(),i=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"],_.each(i,function(t){return r.prototype[t]=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n.unshift(this.models),_[t].apply(_,n)}}),o=["groupBy","countBy","sortBy"],_.each(o,function(t){return r.prototype[t]=function(e,n){var r;return r=_.isFunction(e)?e:function(t){return t.get(e)},_[t](this.models,r,n)}}),r}])}).call(this);
(function(){var t,n={}.hasOwnProperty,e=function(t,e){function i(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};t=angular.module("fs.collections"),t.factory("PaginationCollection",["BaseCollection","BaseModel","$q",function(t,n,i){var o;return o=function(t){function n(t,e){var i;i={exhausted:!1,limit:10,token:null},e=_.extend({},e),e.pagination=_.extend(i,e.pagination),n.__super__.constructor.call(this,t,e)}return e(n,t),n.prototype.parse=function(t){var e;return e=t.data,(null!=e?e.length:void 0)?this.pagination.token=_(e).last().pagination_token:this.pagination.exhausted=!0,n.__super__.parse.call(this,t)},n.prototype.reset=function(){return n.__super__.reset.apply(this,arguments),this.pagination.exhausted=!1,this.pagination.token=null,this},n.prototype.canFetch=function(){return this.pagination.exhausted===!1&&this.currentlyFetching===!1},n.prototype.nextPage=function(t){var n,e;return t=_.extend({},t),n={},this.pagination.token?n.page_token=this.pagination.token:(n.offset=this.length,n.limit=this.pagination.limit),t.params=_.extend(n,t.params),e=this.fetch(t),e["catch"](function(t){return function(n){return t.pagination.exhausted=!0,i.reject(n)}}(this)),e},n}(t)}])}).call(this);
(function(){var t,e=[].slice;t=angular.module("fs.collections"),t.factory("BaseModel",["$http",function(t){var i,r;return i=function(){function e(t,e){var i,r;null==t&&(t={}),null==e&&(e={});for(i in e)r=e[i],this[i]=r;this.attributes={},t=_.defaults(t,_.result(this,"defaults")),this.set(t)}return e.prototype.parse=function(t){return t.data},e.prototype._hasIdAttribute=function(t){return _(Object.keys(t)).contains(this.idAttribute)},e.prototype.has=function(t){return null!=this.attributes[t]},e.prototype.get=function(t){return this.attributes[t]},e.prototype.set=function(t,e){var i,r,n;if(!t)return this;"object"==typeof t?n=t:(n={},n[t]=e),this._hasIdAttribute(n)&&(this.id=n[this.idAttribute]);for(i in n)r=n[i],this.attributes[i]=r;return this},e.prototype.urlRoot="",e.prototype.idAttribute="id",e.prototype.isNew=function(){return null!=this.id?!1:!0},e.prototype.url=function(){var t,e;return t=_.result(this,"urlRoot")||_.result(this.collection,"url"),this.isNew()?t:(e=encodeURIComponent(this.id),t+("/"===t.charAt(t.length-1)?e:"/"+e))},e.prototype.toJSON=function(){return _.clone(this.attributes)},e.prototype.fetch=function(e){var i;return null==e&&(e={}),i=_.extend({},e),_(i).defaults({method:"GET",url:_.result(this,"url")}),t(i).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},e.prototype.save=function(e){var i;return null==e&&(e={}),i=_.extend({},e),_(i).defaults({method:this.isNew()?"POST":"PUT",url:_.result(this,"url"),data:this.toJSON()}),t(i).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},e.prototype.destroy=function(e){return null==e&&(e={}),this.collection&&this.collection.remove(this),this.isNew()?void 0:(_(e).defaults({method:"DELETE",url:this.url("delete")}),t(e).then(_(this.parse).bind(this)))},e}(),r=["keys","values","pairs","invert","pick","omit"],_.each(r,function(t){return i.prototype[t]=function(){var i;return i=1<=arguments.length?e.call(arguments,0):[],i.unshift(this.attributes),_[t].apply(_,i)}}),i}])}).call(this);