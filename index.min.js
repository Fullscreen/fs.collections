(function(){angular.module("fs.collections",[])}).call(this);
(function(){angular.module("fs.collections").provider("fsCache",function(){var t,e;return t=!1,e=6e4,this.setCacheTTL=function(t){return e=t},this.setCacheEnabled=function(e){return t=e},this.$get=["$http","$cacheFactory","$timeout",function(n,c,r){var o,u,i;return u=!1,t&&(u=c("fs.collections")),o=function(t,e){return e.length>0&&(t+=(-1===t.indexOf("?")?"?":"&")+e),t},i=function(){function t(){}return t.prototype.cacheTimeout=null,t.prototype.cache=u,t.prototype.cacheTTL=e,t.prototype._bustWithOpts=function(t){return this.cache.remove(o(t.url,t.paramSerializer(t.params)))},t.prototype.scheduleCacheTimeout=function(t){return t&&t.cache&&t.url?this.cacheTimeout=r(function(e){return function(){return e._bustWithOpts(t)}}(this),t.cacheTTL):void 0},t}()}],this})}).call(this);
(function(){var t,e=function(t,e){function o(){this.constructor=t}for(var n in e)r.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},r={}.hasOwnProperty,o=[].slice;t=angular.module("fs.collections"),t.factory("BaseCollection",["$http","BaseModel","fsCache",function(t,r,n){var i,s,u;return i=function(o){function n(t,e){this.opts=e,this.opts&&(this.opts.model&&(this.model=this.opts.model),this.opts.url&&(this.url=this.opts.url),this.opts.sort&&(this.sort=this.opts.sort),this.opts.comparator&&(this.comparator=this.opts.comparator),this.opts.parse&&"function"==typeof this.opts.parse&&(this.parse=this.opts.parse,delete this.opts.parse)),this.models=[],this.length=0,this.add(t,this.opts)}return e(n,o),n.prototype.model=r,n.prototype.currentlyFetching=!1,n.prototype.url=function(){},n.prototype.parse=function(t){return t.data},n.prototype.fetch=function(e){var r,o;return r={cache:this.cache,cacheTTL:this.cacheTTL,merge:!0,parse:!0,method:"GET",url:_(this).result("url")},e=_.extend(r,e),e.params&&(e.params=_.extend({},e.params)),e.data&&(e.data=_.extend({},e.data)),this.currentlyFetching=!0,o=t(e).then(function(t){return function(r){return t.scheduleCacheTimeout(r.config),e.reset&&t.reset(),t.add(r,e),t}}(this)),o["finally"](function(t){return function(){return t.currentlyFetching=!1}}(this)),o},n.prototype.eq=function(t){var e;return null!=(e=this.models)?e[t]:void 0},n.prototype.get=function(t){return _(this.models).findWhere({id:t})},n.prototype.remove=function(t){var e,r;return e=!_(t).isArray(),e&&(t=[t]),r=[],_(t).forEach(function(t){return function(e){var o;return o=t.indexOf(e),-1!==o?(r.push(e),t.models.splice(o,1),t.length--):void 0}}(this)),e?r[0]:r},n.prototype.add=function(t,e){var r,o,n;return e=_.extend({sort:!0},e),e.parse&&(t=this.parse(t)),t?(n=!_(t).isArray(),t=n?[t]:t.slice(),r=[],o="undefined"==typeof e.at?this.length:e.at,t.forEach(function(t){return function(n){var i;return n=t._prepareModel(n,e),i=t.get(n.id),null==i?(r.push(n),t.length++,t.models.splice(o,0,n),o++):e.merge?i.set(n.attributes):void 0}}(this)),e.sort&&this.sort(),n?r[0]:r):void 0},n.prototype.create=function(t,e){var r;return r=this.add(t,e),r?r.save():void 0},n.prototype.clone=function(){return new this.constructor(this.toJSON(),this.opts)},n.prototype.toJSON=function(){return _.map(this.models,function(t){return t.toJSON()})},n.prototype.reset=function(){return this.models=[],this.length=0,this},n.prototype.sort=function(){return this.comparator?this.models.sort(this.comparator):void 0},n.prototype._prepareModel=function(t,e){var r;return e=_.extend({collection:this},e),t instanceof this.model?(r=t,r.collection=this):r=new this.model(t,e),r},n.prototype.pluck=function(t){return _.invoke(this.models,"get",t)},n.prototype.where=function(t,e){return t?this[e?"find":"filter"](function(e){var r,o;for(r in t)if(o=t[r],t[r]!==e.get(r))return!1;return!0}):e?void 0:[]},n.prototype.findWhere=function(t){return this.where(t,!0)},n}(n),u=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"],_.each(u,function(t){return i.prototype[t]=function(){var e;return e=1<=arguments.length?o.call(arguments,0):[],e.unshift(this.models),_[t].apply(_,e)}}),s=["groupBy","countBy","sortBy"],_.each(s,function(t){return i.prototype[t]=function(e,r){var o;return o=_.isFunction(e)?e:function(t){return t.get(e)},_[t](this.models,o,r)}}),i}])}).call(this);
(function(){var t,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty,r=[].slice;t=angular.module("fs.collections"),t.factory("BaseModel",["$http","$rootScope","fsCache",function(t,n,i){var u,s;return u=function(i){function u(t,e){null==t&&(t={}),null==e&&(e={}),e.parse&&(t=this.parse(t)),this._eventBus=n.$new(),this._eventBus.destuctors={},this._eventBus.$on("$destroy",function(t){return function(){return _(t._eventBus.destuctors).each(function(t){return t.forEach(function(t){return t.unwatch()})})}}(this)),e.collection&&(this.collection=e.collection),e.urlRoot&&(this.urlRoot=e.urlRoot),e.idAttribute&&(this.idAttribute=e.idAttribute),e.defaults&&(this.defaults=e.defaults),this.attributes={},t=_.extend({},t),t=_.defaults(t,_.result(this,"defaults")),this.set(t)}return e(u,i),u.prototype.parse=function(t){return t.status&&t.headers?t.data:t},u.prototype._hasIdAttribute=function(t){return _(Object.keys(t)).contains(this.idAttribute)},u.prototype.trigger=function(){var t;return t=1<=arguments.length?r.call(arguments,0):[],this._eventBus.$broadcast.apply(this._eventBus,t)},u.prototype.on=function(t,e){var n,i;return this._eventBus.destuctors[t]||(this._eventBus.destuctors[t]=[]),n=this._eventBus.destuctors[t],i=function(){var t,n,i;return i=arguments[0],n=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],e.apply(this,[n].concat(t))},n.push({unwatch:this._eventBus.$on(t,i),original:e})},u.prototype.off=function(t,e){var n,r;return n=this._eventBus.destuctors[t]||[],r=[],r=e?n.filter(function(t){return t.original===e}):n,r.forEach(function(t){return t.unwatch()})},u.prototype.once=function(t,e){var n;return n=function(i){return function(){var u;return u=1<=arguments.length?r.call(arguments,0):[],i.off(t,n),e.apply(i,u)}}(this),this.on(t,n)},u.prototype.has=function(t){return null!=this.attributes[t]},u.prototype.get=function(t){return this.attributes[t]},u.prototype.set=function(t,e){var n,r;return t?("object"==typeof t?n=t:(n={},n[t]=e),r={},this._hasIdAttribute(n)&&(this.id=n[this.idAttribute]),_(n).each(function(t){return function(e,n){return t.attributes[n]!==e&&(r[n]=e),t.attributes[n]=e}}(this)),this.trigger("change",this,r),_(r).each(function(t){return function(e,n){return t.trigger("change:"+n,t,e)}}(this)),this):this},u.prototype.urlRoot="",u.prototype.idAttribute="id",u.prototype.isNew=function(){return null!=this.id?!1:!0},u.prototype.url=function(){var t,e;return t=_.result(this,"urlRoot")||_.result(this.collection,"url"),this.isNew()?t:(e=encodeURIComponent(this.id),t+("/"===t.charAt(t.length-1)?e:"/"+e))},u.prototype.toJSON=function(){return _.clone(this.attributes)},u.prototype.fetch=function(e){var n;return null==e&&(e={}),n=_.extend({cache:this.cache,cacheTTL:this.cacheTTL},e),_(n).defaults({method:"GET",url:_.result(this,"url")}),t(n).then(function(t){return function(e){return t.scheduleCacheTimeout(e.config),e}}(this)).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},u.prototype.save=function(e){var n;return null==e&&(e={}),n=_.extend({},e),_(n).defaults({method:this.isNew()?"POST":"PUT",url:_.result(this,"url"),data:this.toJSON()}),t(n).then(function(t){return function(e){return t._bustWithOpts(e.config),e}}(this)).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},u.prototype.destroy=function(e){var n;return null==e&&(e={}),this.collection&&this.collection.remove(this),n=function(t){return function(){return t.trigger("destroy",t,t.collection,e),t._eventBus.$destroy()}}(this),this.isNew()?n():(_(e).defaults({method:"DELETE",url:this.url("delete")}),t(e)(function(t){return function(e){return t._bustWithOpts(e.config),e}}(this)).then(_(this.parse).bind(this)).then(n))},u}(i),s=["keys","values","pairs","invert","pick","omit"],_.each(s,function(t){return u.prototype[t]=function(){var e;return e=1<=arguments.length?r.call(arguments,0):[],e.unshift(this.attributes),_[t].apply(_,e)}}),u}])}).call(this);