(function(){angular.module("fs.collections",[])}).call(this);
(function(){var t,e=[].slice;t=angular.module("fs.collections"),t.factory("BaseCollection",["$http","BaseModel",function(t,r){var n,o,i;return n=function(){function e(t,e){var r,n,o;this.opts=e,n=this.opts;for(r in n)o=n[r],this[r]=o;this.models=[],this.length=0,this.add(t)}return e.prototype.model=r,e.prototype.currentlyFetching=!1,e.prototype.url=function(){},e.prototype.parse=function(t){return t.data},e.prototype.fetch=function(e){var r,n;return r={method:"GET",url:_(this).result("url")},e=_.extend(r,e),e.params&&(e.params=_.extend({},e.params)),e.data&&(e.data=_.extend({},e.data)),this.currentlyFetching=!0,n=t(e).then(_.bind(this.parse,this)).then(function(t){return function(r){return e.reset&&t.reset(),t.add(r),t}}(this)),n["finally"](function(t){return function(){return t.currentlyFetching=!1}}(this)),n},e.prototype.eq=function(t){var e;return null!=(e=this.models)?e[t]:void 0},e.prototype.get=function(t){return _(this.models).findWhere({id:t})},e.prototype.remove=function(t){var e,r;return e=!_(t).isArray(),e&&(t=[t]),r=[],_(t).forEach(function(t){return function(e){var n;return n=t.indexOf(e),-1!==n?(r.push(e),t.models.splice(n,1),t.length--):void 0}}(this)),e?r[0]:r},e.prototype.add=function(t,e){var r,n,o;if(t)return e=_.extend({sort:!0},e),o=!_(t).isArray(),t=o?[t]:t.slice(),r=[],n="undefined"==typeof e.at?this.length:e.at,t.forEach(function(t){return function(e){return e=t._prepareModel(e),null==t.get(e.id)?(r.push(e),t.length++,t.models.splice(n,0,e),n++):void 0}}(this)),e.sort&&this.sort(),o?r[0]:r},e.prototype.create=function(t){var e;return e=this.add(t),e?e.save():void 0},e.prototype.clone=function(){return new this.constructor(this.toJSON(),this.opts)},e.prototype.toJSON=function(){return _.map(this.models,function(t){return t.toJSON()})},e.prototype.reset=function(){return this.models=[],this.length=0,this},e.prototype.sort=function(){return this.comparator?this.models.sort(this.comparator):this.models.sort(function(t,e){return t.id-e.id})},e.prototype._prepareModel=function(t){var e;return t instanceof this.model?(e=t,e.collection=this):e=new this.model(t,{collection:this}),e},e.prototype.pluck=function(t){return _.invoke(this.models,"get",t)},e.prototype.where=function(t,e){return t?this[e?"find":"filter"](function(e){var r,n;for(r in t)if(n=t[r],t[r]!==e.get(r))return!1;return!0}):e?void 0:[]},e.prototype.findWhere=function(t){return this.where(t,!0)},e}(),i=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"],_.each(i,function(t){return n.prototype[t]=function(){var r;return r=1<=arguments.length?e.call(arguments,0):[],r.unshift(this.models),_[t].apply(_,r)}}),o=["groupBy","countBy","sortBy"],_.each(o,function(t){return n.prototype[t]=function(e,r){var n;return n=_.isFunction(e)?e:function(t){return t.get(e)},_[t](this.models,n,r)}}),n}])}).call(this);
(function(){var t,e=[].slice;t=angular.module("fs.collections"),t.factory("BaseModel",["$http","$rootScope",function(t,n){var r,u;return r=function(){function r(t,e){var r,u;null==t&&(t={}),null==e&&(e={}),this._eventBus=n.$new(),this._eventBus.destuctors={},this._eventBus.$on("$destroy",function(t){return function(){return _(t._eventBus.destuctors).each(function(t){return t.forEach(function(t){return t.unwatch()})})}}(this));for(r in e)u=e[r],this[r]=u;this.attributes={},t=_.extend({},t),t=_.defaults(t,_.result(this,"defaults")),this.set(t)}return r.prototype.parse=function(t){return t.data},r.prototype._hasIdAttribute=function(t){return _(Object.keys(t)).contains(this.idAttribute)},r.prototype.trigger=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this._eventBus.$broadcast.apply(this._eventBus,t)},r.prototype.on=function(t,n){var r,u;return this._eventBus.destuctors[t]||(this._eventBus.destuctors[t]=[]),r=this._eventBus.destuctors[t],u=function(){var t,r,u;return u=arguments[0],r=arguments[1],t=3<=arguments.length?e.call(arguments,2):[],n.apply(this,[r].concat(t))},r.push({unwatch:this._eventBus.$on(t,u),original:n})},r.prototype.off=function(t,e){var n,r;return n=this._eventBus.destuctors[t]||[],r=[],r=e?n.filter(function(t){return t.original===e}):n,r.forEach(function(t){return t.unwatch()})},r.prototype.once=function(t,n){var r;return r=function(u){return function(){var i;return i=1<=arguments.length?e.call(arguments,0):[],u.off(t,r),n.apply(u,i)}}(this),this.on(t,r)},r.prototype.has=function(t){return null!=this.attributes[t]},r.prototype.get=function(t){return this.attributes[t]},r.prototype.set=function(t,e){var n,r;return t?("object"==typeof t?n=t:(n={},n[t]=e),r={},this._hasIdAttribute(n)&&(this.id=n[this.idAttribute]),_(n).each(function(t){return function(e,n){return t.attributes[n]!==e&&(r[n]=e),t.attributes[n]=e}}(this)),this.trigger("change",this,r),_(r).each(function(t){return function(e,n){return t.trigger("change:"+n,t,e)}}(this)),this):this},r.prototype.urlRoot="",r.prototype.idAttribute="id",r.prototype.isNew=function(){return null!=this.id?!1:!0},r.prototype.url=function(){var t,e;return t=_.result(this,"urlRoot")||_.result(this.collection,"url"),this.isNew()?t:(e=encodeURIComponent(this.id),t+("/"===t.charAt(t.length-1)?e:"/"+e))},r.prototype.toJSON=function(){return _.clone(this.attributes)},r.prototype.fetch=function(e){var n;return null==e&&(e={}),n=_.extend({},e),_(n).defaults({method:"GET",url:_.result(this,"url")}),t(n).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},r.prototype.save=function(e){var n;return null==e&&(e={}),n=_.extend({},e),_(n).defaults({method:this.isNew()?"POST":"PUT",url:_.result(this,"url"),data:this.toJSON()}),t(n).then(_(this.parse).bind(this)).then(_(this.set).bind(this))},r.prototype.destroy=function(e){var n;return null==e&&(e={}),this.collection&&this.collection.remove(this),n=function(t){return function(){return t.trigger("destroy",t,t.collection,e),t._eventBus.$destroy()}}(this),this.isNew()?n():(_(e).defaults({method:"DELETE",url:this.url("delete")}),t(e).then(_(this.parse).bind(this)).then(n))},r}(),u=["keys","values","pairs","invert","pick","omit"],_.each(u,function(t){return r.prototype[t]=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n.unshift(this.attributes),_[t].apply(_,n)}}),r}])}).call(this);